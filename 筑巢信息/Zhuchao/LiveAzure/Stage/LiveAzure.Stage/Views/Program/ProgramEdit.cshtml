@{
    Layout = null;
}
@model LiveAzure.Models.General.GeneralProgram
<script src="@Url.Content("~/Scripts/jquery.validate.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.unobtrusive.js")" type="text/javascript"></script>
<script type="text/javascript">
<!--
    /*-----------------------
    提交保存程序节点表单
    ------------------------*/
    function submitForm() {
        $("#programForm").submit();
    }
    /*-----------------------
    显示程序功能节点
    ------------------------*/
    function showProgramNode() {
        var progmain = document.getElementById("progMain");
        var progdetail = document.getElementById("progDetail");
        progmain.style.display = "none";
        progdetail.style.dispaly = "block";
        var id = $("#Gid").val();
        $.ajax({
            type: "GET",
            url: "/Program/NodeIndex",
            data: { id: id },
            success: function (html) {
                $("#progDetail").html(html);
            }
        });
        ClosePanel();
    }
    /*-----------------------
    关闭编辑页面
    ------------------------*/
    function closeEdit() {
        $.ajax({
            type: "POST",
            url: "/Program/Tree",
            success: function (html) {
                $("#progMain").html(html);
            }
        });
        var progedit = document.getElementById("progEdit");
        progedit.style.display = "none";
    }
//-->
</script>
<div id="Pro" style="margin: 2px;">
    @using (Ajax.BeginForm("ProgramEditSave", "Program", new { gid = Model.Gid }, new AjaxOptions { UpdateTargetId = "progMain", OnSuccess = "UnitPricePanel.CloseEditPanel();" }))
    {
    <div class="down_AddorEdit">
        <table>
            <tr>
                <th>
                    @LiveAzure.Resource.Model.General.GeneralProgram.Parent
                </th>
                <td>
                    @Html.HiddenFor(model => model.Gid)
                    @if (Model.Parent != null)
                    {
                        @ViewBag.ParentName
                    }
                </td>
            </tr>
            <tr>
                <th>
                    @LiveAzure.Resource.Model.General.GeneralProgram.Code
                </th>
                <td>
                    @Html.EditorFor(model => model.Code)
                    @Html.ValidationMessageFor(model => model.Code)
                </td>
            </tr>
            <tr>
                <th>
                    @LiveAzure.Resource.Model.General.GeneralProgram.Name
                </th>
                <td>
                    @Html.EditorFor(model => model.Name, "Matter")
                </td>
            </tr>
            <tr>
                <th>
                    @LiveAzure.Resource.Model.General.GeneralProgram.ProgUrl
                </th>
                <td>
                    @Html.EditorFor(model => model.ProgUrl)
                    @Html.ValidationMessageFor(model => model.ProgUrl)
                </td>
            </tr>
            <tr>
                <th>
                    @LiveAzure.Resource.Model.General.GeneralProgram.Sorting
                </th>
                <td>
                    @Html.EditorFor(model => model.Sorting)
                    @Html.ValidationMessageFor(model => model.Sorting)
                </td>
            </tr>
            <tr>
                <th>
                    @LiveAzure.Resource.Model.General.GeneralProgram.Terminal
                </th>
                <td>
                    @Html.DropDownListFor(model => model.Terminal, ViewBag.TerminalList as IEnumerable<SelectListItem>)
                </td>
            </tr>
            <tr>
                <th>
                    @LiveAzure.Resource.Model.General.GeneralProgram.Show
                </th>
                <td>
                    @Html.DropDownListFor(model => model.Show, ViewBag.showList as IEnumerable<SelectListItem>)
                </td>
            </tr>
            <tr>
                <td>
                    <input type="submit" value="@LiveAzure.Resource.Common.Submit"  />
                </td>    
                <td>    
                    <input type="reset" value="@LiveAzure.Resource.Common.Reset" />
                    @if (Model.Terminal == true)
                    {
                        <input id="programItem" type="button" value="@LiveAzure.Resource.Model.General.GeneralProgram.ProgramNodes" onclick="showProgramNode()" style="visibility:hidden"/>
                    }
                </td>
            </tr>
            @if ((Model.Terminal == true) && (Model.ProgramNodes != null) && (Model.ProgramNodes.Count > 0))
            {
                <tr>
                    <td colspan="2">
                        <table class="DIY_table" border="1">
                            <tr>
                                <td>@LiveAzure.Resource.Model.General.GeneralProgNode.Code</td>
                                <td>@LiveAzure.Resource.Model.General.GeneralProgNode.Name</td>
                                <td>@LiveAzure.Resource.Model.General.GeneralProgNode.Optional</td>
                            </tr>
                            @foreach (var item in Model.ProgramNodes)
                            {
                                if (item.Deleted == false)
                                {
                                <tr>
                                    <td>@item.Code</td>
                                    <td>@item.Name.GetResource(ViewBag.Culture)</td>
                                    <td>
                                        @if (item.Optional != null)
                                        {
                                            @item.Optional.GetResource(ViewBag.Culture)
                                        }
                                    </td>
                                </tr>
                                }
                            }
                        </table>
                    </td>
                </tr>
            }
        </table>         
    </div>
    }
</div>
<script type="text/javascript">
<!--
    var showItemButton = $("#Terminal").val();
    if (showItemButton == "true") {
        var programitem = document.getElementById("programItem");
        programitem.style.visibility = "visible";
    }
//-->
</script>
