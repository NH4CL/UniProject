@using MVC.Controls;
@using MVC.Controls.Grid;
@model LiveAzure.Models.Member.MemberChannel
@{
    ViewBag.Title = "PrivChannel";
    Layout = null;
}
<div id="privChannel">
@using (Ajax.BeginForm("PrivChannel", "Privilege", new AjaxOptions { OnSuccess = "grid2Reload" }))
{
    @Html.ValidationSummary(true)
    <div>
       <input type="checkbox" id="cPstatus" name="cPstatus" onclick="onShow()"/>
       <span>@LiveAzure.Resource.Stage.PrivilegeController.on</span>
    </div>
    <div id = "listPrivCha">
      <input type="hidden" id="optitemCount" name="optitemCount" value="0" />
      <input type="hidden" id="prvID" name="prvID"/>
      @{
        string listUrl = "/Privilege/ListmemChannel?chaSearchString=" + ViewBag.chaSearchStr;
        }
    @Html.Grid(new GridControl()
        .SetName("gridPrivCha")
        .SetPageSize(10)
        .SetIsAutoSize(true)
        .SetHttpVerb(HttpVerbs.Get)
        .SetListUrl("/Privilege/ListPrivChannel")
        .SetHeight("'100%'")
        .SetColumns<LiveAzure.Models.Member.MemberChannel>(cs =>
        {
            cs.Add(x => x.Gid).SetAsPrimaryKey().SetHidden(true);
            cs.Add(x => x.Code).SetCaption(@LiveAzure.Resource.Stage.OrganizationController.channel+ @LiveAzure.Resource.Model.Member.OrganizationBase.Code);
            cs.Add(x => x.ShortName.Matter).SetCaption(@LiveAzure.Resource.Stage.OrganizationController.channel+ @LiveAzure.Resource.Model.Member.OrganizationBase.ShortName);
        })
            )
    <input type="button" id="delCha" name="delCha" value="@LiveAzure.Resource.Stage.PrivilegeController.delete" onclick="DeletePriCha()"/>
    </div>
     <br />
   
    <table>
        <tr>
            <th>@LiveAzure.Resource.Stage.PrivilegeController.keyword:</th> 
            <td>@Html.TextBox("chaSearchString",ViewBag.CurrentFilter as string) &nbsp;</td>
            <td><input type="button" id="chaSearch" name="chaSearch" value="@LiveAzure.Resource.Stage.PrivilegeController.search" onclick="searchCha()"/></td>
        </tr>
    </table>

    
 <script type="text/javascript">
    var UnitPricePanel = new OpenPanel();
    UnitPricePanel.bLoading = true;
    UnitPricePanel.width = 500;
    UnitPricePanel.height = 600;
    UnitPricePanel.title = "@LiveAzure.Resource.Stage.PrivilegeController.channelPriv";
    UnitPricePanel.closeurl = "@Url.Content("~/Content/themes/base/images/close.gif")";
     function grid2Reload() {
         $("#gridPrivCha").trigger('reloadGrid');
     }

     function DeletePriCha() {
         var id = $("#gridPrivCha").jqGrid("getGridParam", "selrow");
         if (confirm('@LiveAzure.Resource.Stage.PrivilegeController.delConfirm')) {
             $.post("/Privilege/DeletePriCha", { Gid: id }, function (data) {
                 $("#gridPrivCha").trigger('reloadGrid');
             });
         }
     }

     function onShow() {
        var IsCheck;
         if ($("#cPstatus").attr('checked')) {
             $("#cadd").attr("disabled", false);
             $("#delCha").attr("disabled", false);
             IsCheck = true;
         }
         else {
             $("#cadd").attr("disabled", true);
             $("#delCha").attr("disabled", true);
             IsCheck = false;
         }
         $.ajax({
            type: "POST",
            url: "/Privilege/DelAll",
            data: { IsCheck: IsCheck, ptype: 3 },
            datatype: "html",
            error: function () {
                alert("@LiveAzure.Resource.Common.OperationFailed");
            }
        });
     }

     function searchCha() {
         UnitPricePanel.OpenPanel();
         var searchString = $("#chaSearchString").val();
         $.ajax({
             type: "POST",
             url: "/Privilege/PrivChannelAdd",
             data: { chaSearchString: searchString },
             datatype: "html",
             success: function (data) {
                 UnitPricePanel.EditPageHtml(data);
             },
             error: function () {
                 alert("@LiveAzure.Resource.Common.OperationFailed");
             }
         });
     }

     $(document).ready(function () {
         if ('@(ViewBag.pStatusC)' == 1) {
             $("#cPstatus").attr('checked', true);
             $("#cadd").attr("disabled", false);
             $("#delCha").attr("disabled", false);
         }
         else {
             $("#cPstatus").attr('checked', false);
             $("#cadd").attr("disabled", true);
             $("#delCha").attr("disabled", true);
         }
     });

</script>
}
</div>