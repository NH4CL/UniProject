@using MVC.Controls;
@using MVC.Controls.Grid;
@model LiveAzure.Models.Purchase.PurchaseSupplier
@{
    ViewBag.Title = "SupplierIndex";
}
<div id="ListBlock">
    <div>
       @LiveAzure.Resource.Stage.UserController.organization
       @Html.DropDownListFor(model=>model.aParent, (List<SelectListItem>)ViewBag.organization, new { id = "orgCode", name = "orgCode", style = "width:270px;", onchange = "changeOrg()" })
    </div>
    <div>
        @Html.Grid(new GridControl()
            .SetName("gridSupplier")
            .SetPageSize(10)
            .SetIsAutoSize(false)
            .SetHttpVerb(HttpVerbs.Get)
            .SetListUrl("/Organization/ListSupplier")
            .SetHeight("'100%'")
            .SetWidth("600")
            .SetColumns<LiveAzure.Models.Member.MemberOrganization>(cs =>
                {
                    cs.Add(x => x.Gid).SetAsPrimaryKey().SetHidden(true);
                    cs.Add(x => x.Code).SetCaption(LiveAzure.Resource.Model.Member.OrganizationBase.Code);
                    cs.Add(x => x.FullName.Matter).SetCaption(LiveAzure.Resource.Model.Member.OrganizationBase.FullName);
                    cs.Add(x => x.ShortName.Matter).SetCaption(LiveAzure.Resource.Model.Member.OrganizationBase.ShortName);
                    cs.Add(x => x.Ostatus).SetCaption(LiveAzure.Resource.Model.Member.OrganizationBase.Ostatus);
                    cs.Add(x => x.Sorting).SetCaption(LiveAzure.Resource.Model.Member.OrganizationBase.Sorting);
                })
           )
    <br />
    @if (ViewBag.privEnableEdit == "1"){
        <input type="button" value="@LiveAzure.Resource.Common.Add" onclick="addSupplier()"/>
        <input type="button" value="@LiveAzure.Resource.Common.Edit" onclick="editSupplier()"/>
    }
    else
    {
        <input type="button" value="@LiveAzure.Resource.Common.Add" disabled="disabled"/>
        <input type="button" value="@LiveAzure.Resource.Common.Edit" disabled="disabled"/>
    }
    <input type="button" value="@LiveAzure.Resource.Model.Member.OrganizationBase.Introduction" onclick="OrganizationIntroduction();" />
    @if (ViewBag.privEnableDelete == "1")
    {
        <input type="button" value="@LiveAzure.Resource.Common.Delete" id="delWare" onclick="deleteSupplier()"/> 
    }
    else
    {
        <input type="button" value="@LiveAzure.Resource.Common.Delete" disabled="disabled"/>
    }
    </div>
</div>
<div id="SupplierAddorEditBlock"></div>
<script type ="text/javascript">
    function changeOrg() {
        var id = $("#orgCode option:selected").val();
        var allids = $("#gridSupplier").jqGrid("getDataIDs");
        $.ajax({
            type: "POST",
            url: "/Organization/changeOrg",
            data: { currentid: id },
            datatype: "html",
            success: function (data) {
                $("#gridSupplier").trigger('reloadGrid');
            },
            error: function () {
                alert("@LiveAzure.Resource.Common.OperationFailed");
            }
        });
    }
    function addSupplier() {
        $("#ListBlock").fadeOut("fast");
        $.post("/Organization/OrgDetail", { OrgType: "supplier", ParentOrgID: $("#orgCode").val() }, function (backdata) {
            $("#SupplierAddorEditBlock").html(backdata);
        });
    }
    function editSupplier() {
        var id = $("#gridSupplier").jqGrid("getGridParam", "selrow");
        if (id == null) {
            alert("@LiveAzure.Resource.Common.PleaseSelectRow");
        }
        else {
            $("#ListBlock").fadeOut("fast");
            $.post("/Organization/OrgDetail", { OrgType: "supplier", Gid: id, ParentOrgID: $("#orgCode").val() }, function (backdata) {
                $("#SupplierAddorEditBlock").html(backdata);
            });
        }
    }
    function deleteWarehouse() {
        var delewareid = $("#gridSupplier").jqGrid("getGridParam", "selrow");
        if (delewareid == null)
        { alert("@LiveAzure.Resource.Common.PleaseSelectRow"); }
        else {
            if (confirm("@LiveAzure.Resource.Common.DeleteConfirm")) {
                $.post("/Organization/deleteSupp", { strdeleid: delewareid }, function (data) {
                    $("#gridSupplier").trigger('reloadGrid');
                });
            }
        }
    }
    function OrganizationIntroduction() {
        var id = $("#gridSupplier").jqGrid("getGridParam", "selrow");
        if (id == null)
            alert("@LiveAzure.Resource.Common.PleaseSelectRow");
        else {
            window.location.href = "/Organization/OrgIntroduction?OrgType=supplier&Gid=" + id;
        }
    }
</script>
