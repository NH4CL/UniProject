@using CommonResource = LiveAzure.Resource.Common
@using WarehouseMovingResource = LiveAzure.Resource.Model.Warehouse.WarehouseMoving
@using WCResource = LiveAzure.Resource.Stage.WarehouseController
@model LiveAzure.Models.Warehouse.WarehouseMoving

<h2>WarehouseMovingAdd</h2>

@{
    List<SelectListItem> ddlWarehouse = ViewBag.WarehouseList as List<SelectListItem>;
    List<SelectListItem> ddlMtype = ViewBag.MtypeList as List<SelectListItem>;
}

@using(Html.BeginForm("MovingAddDB", "Warehouse", FormMethod.Post))
{
    <table>
        <tr>
            <td><b>@WarehouseMovingResource.Code</b></td>
            <td><input type="text" value="@WCResource.AutoGenerate" disabled="disabled" /></td>
        </tr>
        <tr>
            <td><b>@WarehouseMovingResource.OldWarehouse</b></td>
            <td>@Html.DropDownListFor(model => model.OldWhID, ddlWarehouse, new { id = "oldWH" })</td>
        </tr>
        <tr>
            <td><b>@WarehouseMovingResource.NewWarehouse</b></td>
            <td>@Html.DropDownListFor(model => model.NewWhID, ddlWarehouse, new { id = "newWH" })</td>
        </tr>
        <tr>
            <td><b>@WarehouseMovingResource.Mtype</b></td>
            <td>
                @Html.TextBoxFor(model => model.MoveTypeName, new { id = "mType_txt", @readonly = "readonly" })
                @Html.HiddenFor(model => model.Mtype, new { id = "mType_val" })
                @Html.DropDownList("ddlMtype", ddlMtype, new { id = "ddlMtype", style = "display:none" })
            </td>
        </tr>
        <tr>
            <td><b>@WarehouseMovingResource.Total</b></td>
            <td>@Html.TextBoxFor(model => model.Total, new { disabled = "disabled" })</td>
        </tr>
        <tr>
            <td><b>@WarehouseMovingResource.Shipper</b></td>
            <td>@Html.DropDownList("ShipID", new List<SelectListItem>(), new { id = "shipID", disabled = "disabled" })</td>
        </tr>
        <tr>
            <td><b>@WarehouseMovingResource.Reason</b></td>
            <td>@Html.TextAreaFor(model => model.Reason)</td>
        </tr>
        <tr>
            <td><b>@LiveAzure.Resource.Model.ModelBase.Remark</b></td>
            <td>@Html.TextAreaFor(model => model.Remark)</td>
        </tr>
    </table>
    <input type="submit" value="@CommonResource.Add" />
    <input type="reset" value="@CommonResource.Reset" />
    <input type="button" id="btnCancel" value="@CommonResource.Cancel" />
}

<script type="text/javascript">
    function getMovingTypeName(type) {
        var name;
        var list = $("#ddlMtype option");
        $.each(list, function (index, obj) {
            var temp = $(obj).val();
            if (temp == type)
                name = $(obj).text();
        });
        return name;
    }
    function changeMovingType() {
        var type;
        if ($("#oldWH").val() == $("#newWH").val())
            type = "1";
        else type = "0";
            $("#mType_val").val(type);
        var name = getMovingTypeName(type);
        $("#mType_txt").val(name);
    }
    function refreshElement() {
        changeMovingType();
        if ($("#oldWH").val() == $("#newWH").val()) {
            //移货位
            $("#shipID").empty();
            $("#shipID").attr("disabled", "disabled");
        } else {
            //移库
            $("#shipID").attr("disabled", "disabled");

            //刷新下拉列表
            $.post("/Warehouse/GetShippings", { whID: $("#oldWH").val() },
                    function (data) {
                        $("#shipID").empty();
                        $.each(data, function (index, obj) {
                            var item = new Option(obj.Text, obj.Value);
                            $(item).appendTo("#shipID");
                        });
                        $("#shipID").removeAttr("disabled");
                    });
        }
    }
    $("#btnCancel").click(function () {
        $("#childDiv").fadeOut();
        $("#childDiv").empty();
    });
    $("#oldWH").change(function () {
        refreshElement();
    });
    $("#newWH").change(function () {
        refreshElement();
    });
</script>